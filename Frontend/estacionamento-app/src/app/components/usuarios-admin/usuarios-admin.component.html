<div class="container">
  <h1><mat-icon class="title-icon">people</mat-icon> Gerenciamento de Usuários</h1>

  <div class="actions">
    <button (click)="novoUsuario()" class="btn btn-primary" *ngIf="!showForm">
      + Novo Usuário
    </button>
  </div>

  <!-- Formulário -->
  <div *ngIf="showForm" class="form-section">
    <h2>{{ editando ? 'Editar Usuário' : 'Novo Usuário' }}</h2>
    <form (ngSubmit)="salvarUsuario()">
      <div class="form-group">
        <label for="nome">Nome *</label>
        <input 
          type="text" 
          id="nome"
          [(ngModel)]="usuario.nome" 
          name="nome"
          class="input-field"
          required
          maxlength="100"
          placeholder="Nome completo">
      </div>

      <div class="form-group">
        <label for="email">Email *</label>
        <input 
          type="email" 
          id="email"
          [(ngModel)]="usuario.email" 
          name="email"
          [disabled]="editando"
          class="input-field"
          required
          maxlength="100"
          placeholder="usuario@email.com">
      </div>

      <div class="form-group" *ngIf="!editando">
        <label for="senha">Senha *</label>
        <input 
          type="password" 
          id="senha"
          [(ngModel)]="usuario.senha" 
          name="senha"
          class="input-field"
          required
          minlength="6"
          placeholder="Mínimo 6 caracteres">
      </div>

      <div class="form-group">
        <label for="perfil">Perfil *</label>
        <select 
          id="perfil"
          [(ngModel)]="usuario.perfil" 
          name="perfil"
          class="input-field"
          required>
          <option *ngFor="let p of perfis" [ngValue]="p.valor">{{ p.nome }}</option>
        </select>
      </div>

      <div class="form-actions">
        <button type="submit" class="btn btn-success">
          {{ editando ? 'Atualizar' : 'Criar' }}
        </button>
        <button type="button" (click)="cancelar()" class="btn btn-secondary">
          Cancelar
        </button>
      </div>
    </form>
  </div>

  <div *ngIf="loading" class="loading">Carregando...</div>
  <div *ngIf="error" class="error">{{ error }}</div>

  <!-- Lista de Usuários -->
  <div class="table-section" *ngIf="!loading">
    <h2>Usuários Cadastrados</h2>
    <table *ngIf="usuarios.length > 0">
      <thead>
        <tr>
          <th>Nome</th>
          <th>Email</th>
          <th>Perfil</th>
          <th>Status</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let u of usuarios">
          <td><strong>{{ u.nome }}</strong></td>
          <td>{{ u.email }}</td>
          <td>
            <span class="perfil-badge" [class.admin]="u.perfil === 'Admin'">
              {{ u.perfil }}
            </span>
          </td>
          <td>
            <span class="status-badge" [class.ativo]="u.ativo">
              {{ u.ativo ? 'Ativo' : 'Inativo' }}
            </span>
          </td>
          <td>
            <div class="action-buttons">
              <button 
                (click)="editarUsuario(u)" 
                class="btn btn-small btn-warning" 
                title="Editar">
                Editar
              </button>
              <button 
                (click)="deletarUsuario(u.id!, u.nome)" 
                class="btn btn-small btn-danger" 
                title="Excluir"
                [disabled]="u.id === authService.currentUserValue?.id">
                Excluir
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>

    <div *ngIf="usuarios.length === 0" class="empty-state">
      <p>Nenhum usuário cadastrado</p>
    </div>
  </div>
</div>
